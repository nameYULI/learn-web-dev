### useRef

useRefæ˜¯ä¸€ä¸ªReact Hook å®ƒèƒ½å¸®åŠ©å¼•ç”¨ä¸€ä¸ªä¸éœ€è¦æ¸²æŸ“çš„å€¼

```jsx
const ref = useRef(initialValue)
```

åœ¨ç»„ä»¶é¡¶å±‚è°ƒç”¨useRefä»¥å£°æ˜ä¸€ä¸ªref

```jsx
import { useRef } from 'react';

function MyComponent() {
  const intervalRef = useRef(0);
  const inputRef = useRef(null);
  // ...
}
```

å‚æ•°ï¼š

`initialValue`: refå¯¹è±¡çš„currentå±æ€§çš„åˆå§‹å€¼ å¯ä»¥æ˜¯ä»»æ„ç±»å‹çš„å€¼ è¿™ä¸ªå‚æ•°åœ¨é¦–æ¬¡æ¸²æŸ“åè¢«å¿½ç•¥

è¿”å›å€¼ï¼š

useRefè¿”å›ä¸€ä¸ªåªæœ‰ä¸€ä¸ªå±æ€§çš„å¯¹è±¡

`current`: åˆå§‹å€¼ä¸ºä¼ é€’çš„initialValue ä¹‹åå¯ä»¥å°†å…¶è®¾ç½®ä¸ºå…¶ä»–å€¼ å¦‚æœå°†refå¯¹è±¡ä½œä¸ºä¸€ä¸ªJSXèŠ‚ç‚¹çš„refå±æ€§ä¼ é€’ç»™React Reactå°†ä¸ºå®ƒè®¾ç½®currentå±æ€§

æ³¨æ„ï¼š

1. å¯ä»¥ä¿®æ”¹ref.currentå±æ€§ ä¸stateä¸åŒ å®ƒæ˜¯å¯å˜çš„ ç„¶è€Œå¦‚æœå®ƒæŒæœ‰ä¸€ä¸ªç”¨äºæ¸²æŸ“çš„å¯¹è±¡ï¼ˆä¾‹å¦‚stateçš„ä¸€éƒ¨åˆ†ï¼‰é‚£å°±ä¸åº”è¯¥ä¿®æ”¹è¿™ä¸ªå¯¹è±¡

2. æ”¹å˜ref.currentå±æ€§æ—¶ Reactä¸ä¼šé‡æ–°æ¸²æŸ“ç»„ä»¶ Reactä¸çŸ¥é“å®ƒä½•æ—¶ä¼šå‘ç”Ÿæ”¹å˜ å› ä¸ºrefæ˜¯ä¸€ä¸ªæ™®é€šçš„JavaScriptå¯¹è±¡

3. é™¤äº†åˆå§‹åŒ–å¤– ä¸è¦åœ¨æ¸²æŸ“æœŸé—´å†™å…¥æˆ–è€…è¯»å–ref.current å¦åˆ™ä¼šä½¿ç»„ä»¶è¡Œä¸ºå˜å¾—ä¸å¯é¢„æµ‹

4. åœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹ Reactå°†ä¼šè°ƒç”¨ä¸¤æ¬¡ç»„ä»¶æ–¹æ³• è¿™ä¸ºäº†å¸®åŠ©å‘ç°æ„å¤–é—®é¢˜ ï¼ˆåªæ˜¯å¼€å‘ç¯å¢ƒçš„è¡Œä¸º ä¸ä¼šå½±å“ç”Ÿäº§ç¯å¢ƒï¼‰æ¯ä¸ªrefå¯¹è±¡éƒ½å°†ä¼šåˆ›å»ºä¸¤æ¬¡ ä½†æ˜¯å…¶ä¸­ä¸€ä¸ªç‰ˆæœ¬å°†è¢«ä¸¢å¼ƒ

#### ä½¿ç”¨

##### ç”¨refå¼•ç”¨ä¸€ä¸ªå€¼

åœ¨ç»„ä»¶é¡¶å±‚è°ƒç”¨useRefå£°æ˜ä¸€ä¸ªæˆ–å¤šä¸ªref

```jsx
import { useRef } from 'react';

function Stopwatch() {
  const intervalRef = useRef(0);
  // ..
}
```

useRefè¿”å›ä¸€ä¸ªå…·æœ‰å•ä¸ªcurrentå±æ€§çš„refå¯¹è±¡ å¹¶åˆå§‹åŒ–ä¸ºä½ æä¾›çš„åˆå§‹å€¼

åœ¨åç»­çš„æ¸²æŸ“ä¸­ useRefå°†è¿”å›ç›¸åŒçš„å¯¹è±¡ ä½ å¯ä»¥æ”¹å˜å®ƒçš„currentå±æ€§æ¥å­˜å‚¨ä¿¡æ¯ å¹¶åœ¨ä¹‹åè¯»å–å®ƒ è¿™ä¼šè®©äººè”æƒ³åˆ°state ä½†æ˜¯æœ‰ä¸€ä¸ªé‡è¦çš„åŒºåˆ«

æ”¹å˜refä¸ä¼šè§¦å‘é‡æ–°æ¸²æŸ“ è¿™æ„å‘³ç€refæ˜¯å­˜å‚¨ä¸€äº›ä¸å½±å“ç»„ä»¶è§†å›¾è¾“å‡ºä¿¡æ¯çš„å®Œç¾é€‰æ‹© ä¾‹å¦‚ å¦‚æœéœ€è¦å­˜å‚¨ä¸€ä¸ªinterval IDå¹¶åœ¨ä»¥åæ£€ç´¢å®ƒ é‚£ä¹ˆå¯ä»¥å°†å®ƒå­˜å‚¨åœ¨refä¸­ åªéœ€è¦æ‰‹åŠ¨æ”¹å˜å®ƒçš„currentå±æ€§å³å¯ä¿®æ”¹refçš„å€¼

```jsx
function handleStartClick() {
  const intervalId = setInterval(() => {
    // ...
  }, 1000);
  intervalRef.current = intervalId;
}
```

åœ¨ä¹‹å ä»refä¸­è¯»å–interval IDä¾¿å¯ä»¥æ¸…é™¤å®šæ—¶å™¨

```jsx
function handleStopClick() {
  const intervalId = intervalRef.current;
  clearInterval(intervalId);
}
```

ä½¿ç”¨refå¯ä»¥ç¡®ä¿ï¼š

1. å¯ä»¥åœ¨é‡æ–°æ¸²æŸ“ä¹‹é—´å­˜å‚¨ä¿¡æ¯ï¼ˆæ™®é€šå¯¹è±¡å­˜å‚¨çš„å€¼æ¯æ¬¡æ¸²æŸ“éƒ½ä¼šé‡ç½®ï¼‰

2. æ”¹å˜å®ƒä¸ä¼šè§¦å‘é‡æ–°æ¸²æŸ“ï¼ˆçŠ¶æ€å˜é‡ä¼šè§¦å‘é‡æ–°æ¸²æŸ“ï¼‰

3. å¯¹äºç»„ä»¶çš„æ¯ä¸ªå‰¯æœ¬è€Œè¨€ è¿™äº›ä¿¡æ¯éƒ½æ˜¯æœ¬åœ°çš„ï¼ˆå¤–éƒ¨å˜é‡åˆ™æ˜¯å…±äº«çš„ï¼‰

æ”¹å˜refä¸ä¼šè§¦å‘é‡æ–°æ¸²æŸ“ æ‰€ä»¥refä¸é€‚åˆç”¨äºå­˜å‚¨æœŸæœ›æ˜¾ç¤ºåœ¨å±å¹•ä¸Šçš„ä¿¡æ¯ å¦‚æœ‰éœ€è¦ ä½¿ç”¨stateä»£æ›¿

âš ï¸æ³¨æ„ï¼š

ä¸è¦åœ¨æ¸²æŸ“æœŸé—´å†™å…¥æˆ–è€…è¯»å–ref.current

ReactæœŸæœ›ç»„ä»¶ä¸»ä½“è¡¨ç°å¾—åƒä¸€ä¸ªçº¯å‡½æ•°ï¼š

1. å¦‚æœè¾“å…¥çš„ï¼ˆpropsã€stateä¸ä¸Šä¸‹æ–‡ï¼‰éƒ½æ˜¯ä¸€æ ·çš„ é‚£ä¹ˆå°±åº”è¯¥è¿”å›ä¸€æ ·çš„JSX

2. ä»¥ä¸åŒçš„é¡ºåºæˆ–ç”¨ä¸ç”¨çš„å‚æ•°è°ƒç”¨å®ƒ ä¸åº”è¯¥å½±å“å…¶å®ƒè°ƒç”¨çš„ç»“æœ

åœ¨æ¸²æŸ“æœŸé—´è¯»å–æˆ–å†™å…¥refä¼šç ´åè¿™äº›é¢„æœŸè¡Œä¸º

```jsx
function MyComponent() {
  // ...
  // ğŸš© ä¸è¦åœ¨æ¸²æŸ“æœŸé—´å†™å…¥ ref
  myRef.current = 123;
  // ...
  // ğŸš© ä¸è¦åœ¨æ¸²æŸ“æœŸé—´è¯»å– ref
  return <h1>{myOtherRef.current}</h1>;
}
```

å¯ä»¥åœ¨äº‹ä»¶å¤„ç†ç¨‹åºæˆ–è€…Effectä¸­è¯»å–å’Œå†™å…¥ref

```jsx
function MyComponent() {
  // ...
  useEffect(() => {
    // âœ… å¯ä»¥åœ¨ Effect ä¸­è¯»å–å’Œå†™å…¥ ref
    myRef.current = 123;
  });
  // ...
  function handleClick() {
    // âœ… å¯ä»¥åœ¨äº‹ä»¶å¤„ç†ç¨‹åºä¸­è¯»å–å’Œå†™å…¥ ref
    doSomething(myOtherRef.current);
  }
  // ...
}
```

å¦‚æœä¸å¾—ä¸åœ¨æ¸²æŸ“æœŸé—´è¯»å–æˆ–è€…å†™å…¥ é‚£ä¹ˆåº”è¯¥ä½¿ç”¨stateä»£æ›¿

å½“æ‰“ç ´è¿™äº›è§„åˆ™æ—¶ ç»„ä»¶å¯èƒ½ä»ç„¶å¯ä»¥å·¥ä½œ ä½†æˆ‘ä»¬ä¸ºReactæ·»åŠ çš„å¤§å¤šæ•°æ–°åŠŸèƒ½å°†ä¾èµ–äºè¿™äº›é¢„æœŸè¡Œä¸º

##### é€šè¿‡refæ“ä½œDOM

ä½¿ç”¨refæ“ä½œDOMæ˜¯éå¸¸å¸¸è§çš„è¡Œä¸º Reactå†…ç½®äº†å¯¹å®ƒçš„æ”¯æŒ

é¦–å…ˆ å£°æ˜ä¸€ä¸ªåˆå§‹å€¼ä¸ºnullçš„refå¯¹è±¡ ç„¶åå°†refå±æ€§ä¼ é€’ç»™æƒ³è¦æ“ä½œçš„DOMèŠ‚ç‚¹çš„JSX

```jsx
import { useRef } from 'react';

function MyComponent() {
  const inputRef = useRef(null);
  // ...
  return <input ref={inputRef} />;
}
```

å½“Reactåˆ›å»ºDOMèŠ‚ç‚¹å¹¶å°†å…¶æ¸²æŸ“åˆ°å±å¹•æ—¶ Reactå°†ä¼šæŠŠDOMèŠ‚ç‚¹è®¾ç½®ä¸ºrefå¯¹è±¡çš„currentå±æ€§ ç°åœ¨ä½ å¯ä»¥å€ŸåŠ©refå¯¹è±¡è®¿é—®`<input>`çš„DOMèŠ‚ç‚¹ å¹¶ä¸”å¯ä»¥è°ƒç”¨ç±»ä¼¼äº`focus()`çš„æ–¹æ³•

```jsx
  function handleClick() {
    inputRef.current.focus();
  }
```

å½“èŠ‚ç‚¹ä»å±å¹•ä¸Šç§»é™¤æ—¶ Reactå°†æŠŠcurrentå±æ€§è®¾ç½®å›null

##### é¿å…é‡å¤åˆ›å»ºrefçš„å†…å®¹

Reactä¼šä¿å­˜refçš„åˆå§‹å€¼ å¹¶åœ¨åç»­çš„æ¸²æŸ“ä¸­å¿½ç•¥å®ƒ

```jsx
function Video() {
  const playerRef = useRef(new VideoPlayer());
  // ...
}
```

è™½ç„¶`new VideoPlayer()`çš„ç»“æœåªä¼šåœ¨é¦–æ¬¡æ¸²æŸ“æ—¶ä½¿ç”¨ ä½†æ˜¯ä¾ç„¶åœ¨æ¯æ¬¡æ¸²æŸ“æ—¶éƒ½åœ¨è°ƒç”¨è¿™ä¸ªæ–¹æ³• å¦‚æœæ˜¯åˆ›å»ºæ˜‚è´µçš„å¯¹è±¡ è¿™å¯èƒ½æ˜¯ä¸€ç§æµªè´¹

ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ å¯ä»¥ä¿®æ”¹refçš„åˆå§‹åŒ–æ–¹å¼

```jsx
function Video() {
  const playerRef = useRef(null);
  if (playerRef.current === null) {
    playerRef.current = new VideoPlayer();
  }
  // ...
}
```

é€šå¸¸æƒ…å†µä¸‹ åœ¨æ¸²æŸ“è¿‡ç¨‹ä¸­å†™å…¥æˆ–è¯»å–ref.currentæ˜¯ä¸å…è®¸çš„ ç„¶è€Œ åœ¨è¿™ç§æƒ…å†µä¸‹æ˜¯å¯ä»¥çš„ å› ä¸ºç»“æœæ€»æ˜¯ä¸€æ ·çš„ è€Œä¸”æ¡ä»¶åªæœ‰åœ¨åˆå§‹åŒ–æ—¶æ‰§è¡Œ æ‰€ä»¥å®Œå…¨æ˜¯å¯ä»¥é¢„æµ‹çš„

å¦‚æœä½¿ç”¨äº†ç±»å‹æ£€æŸ¥å™¨ å¹¶ä¸”ä¸æƒ³æ€»æ˜¯æ£€æŸ¥null å¯ä»¥å°è¯•ä»¥ä¸‹æ–¹æ¡ˆï¼š

```jsx
function Video() {
  const playerRef = useRef(null);

  function getPlayer() {
    if (playerRef.current !== null) {
      return playerRef.current;
    }
    const player = new VideoPlayer();
    playerRef.current = player;
    return player;
  }

  // ...
}
```

åœ¨è¿™é‡Œ playerRefæœ¬èº«æ˜¯å¯ä»¥ä¸ºç©ºçš„ ç„¶è€Œåº”è¯¥èƒ½å¤Ÿä½¿ç±»å‹æ£€æŸ¥å™¨ç¡®ä¿¡ ä¸å­˜åœ¨`getPlayer()`è¿”å›nullçš„æƒ…å†µ ç„¶ååœ¨äº‹ä»¶å¤„ç†ç¨‹åºä¸­è°ƒç”¨`getPlayer()`

âš ï¸æ³¨æ„ï¼š

