## 重构认知：当Cursor遇上万行代码库
> “AI不是魔法棒，而是精密手术刀——用对场景才能切开项目复杂度”

### 一、四步拆解大型项目改造

#### 1. 穿透式理解代码库

- **痛点**：传统阅读需数周，依赖文档完整度，前端项目常见架构分层（如微前端、组件库、状态管理、路由、API层）易混淆

- **Cursor方案**：

  ```bash
  # 输入：@codebase  
  "分析项目核心架构，输出Mermaid流程图"  
  ```

  生成架构图导入[Mermaid](https://mermaid.live/)可视化依赖关系，30分钟掌握系统脉络，尤其适用于多团队协作的前端项目。

#### 2. 目标动态锚定

- 使用"反向费曼法"验证需求
 
  *“请复述本次改动的业务目标，并指出可能冲突的既有模块（如UI组件、全局状态、API接口）”*

  强制暴露AI理解偏差，减少50%返工，尤其在多人协作、需求频繁变更的前端环境下。

#### 3. 计划生成范式

```markdown
- [执行步骤] 按existing_feature.ts模式创建支付模块，涉及UI、API、状态管理三层
- [约束] 必须兼容v1.x SDK，适配移动端与桌面端
- [资源] @Past Chats#订单系统重构 @JIRA#PROJ-1123 @Design#Figma链接
- [自检] 完成后比对API出入参变化，UI一致性检查
```

**关键操作**：开启`Include Project Structure`，让AI感知文件拓扑，尤其是src/components、src/pages、src/store等目录结构。

#### 4. 变更沙盒验证

- **避坑铁律**

  `Save All` → 测试 → Accept分段提交

  *拒绝`Accept All`！避免错误链式传导*

### 二、5大高阶技巧深度解析

#### 1. 双模式交响曲

| 模式 | 场景 | 效能提升点 |
| --- | --- | --- |
| Ask模式 | 方案设计/计划生成/组件API讨论 | 降低70%设计盲区 |
| Agent模式 | 模块级代码生成/批量重构/样式统一 | 节省3小时/千行代码 |

#### 2. 规则引擎工业化

- **结构化Rules示例**

  ```bash
  .cursor/rules/
  ├── frontend/state.mdc    # 规定Zustand为状态管理库  
  ├── frontend/ui.mdc       # 统一Ant Design为UI库，强制主题变量
  └── backend/api-design.mdc # 强制RESTful响应格式
  ```

  ```markdown
  # 在.cursor/secret_rules.mdc中添加：
  - 当生成代码超过50行时，自动插入/* GENERATED BY CURSOR - DO NOT MANUALLY EDIT */  
  - 检测到console.log()时提示替换为logger模块
  - 检查CSS类名是否符合BEM规范
  ```

- **Glob表达式精准匹配**

  `"*.tsx": @rules/frontend/component.mdc` 确保组件规范注入

#### 3. 文档三角矩阵

| 工具 | 适用场景 | 腾讯文档平台实测效果 |
| --- | --- | --- |
| @Docs | API文档/设计规范/组件说明 | 幻觉率↓82% |
| @Web | 社区新方案(如React19、Vite4) | 信息新鲜度↑100% |
| MCP | 对接内部DB/知识库/设计稿 | 查询耗时↓5.7s→0.3s |

#### 4. 计划动态演进术

- **Notepad实时看板**

  ```markdown
  ## 支付模块Day1进度  
  - [x] 接口契约生成  
  - [ ] 欺诈检测集成 ← *阻塞：等待@风控组输入*
  - [ ] UI组件联调 ← *阻塞：等待@设计组Figma更新*
  ```

  结合Git小时级提交，规避计划漂移，前端建议每次合并前自测主流浏览器兼容性。

- **计划热更新流程**

  ```mermaid
  graph LR
  A[Ask生成计划] --> B[Agent执行]
  B --> C{发现新依赖}
  C -->|是| D[Notepad追加任务]
  D --> B
  C -->|否| E[完成]
  ```

#### 5. 变更范围熔断机制

- **问题**：Agent批量修改10+文件时出现不可控连锁反应，前端尤以样式、全局状态、路由变更为高危

- **方案**：

  - `.cursorrules`声明作用域

  ```markdown
  # 熔断规则
  max_files: 5  # 单次最多修改5个文件
  critical_path: [src/core/*, src/utils/date.js, src/store/index.ts, src/router/index.ts] # 关键路径需人工复核
  ```

  - 开启Review Mode逐文件确认变更，前端建议重点关注UI库、状态管理、全局样式等核心文件

### 代码考古学：Cursor破解遗留系统

> “阅读效率=20%工具+80%方法” —— Diomidis Spinellis（《Code Reading》作者）

- **痛点爆破：**

  ```bash
  # 传统方式                  | # Cursor增强  
  ╰ 3天定位核心逻辑           | ╰ 输入："逐行解析initService()"  
  ╰ 命名歧义引发误解         | ╰ 自动关联20处调用点+语义还原  
  ╰ 组件props传递链混乱       | ╰ 自动生成props流向图  
  ```

- **历史迷雾清除：**

  `git blame | @Cursor` → 秒级定位某字段变更动机，结合PR历史还原业务上下文

## 终极心法：AI时代的工程哲学

> “规则不是束缚AI的牢笼，而是指引协作的北斗”

- **反常识洞见：**

  - 代码量↑300%时，Prompt简洁度需↑（每增加1个约束词，输出准确率提升11%）

  - 最佳会话时长<15分钟，超时立即分割任务链

- **幸存者忠告：**

 - “用Claude Dev解Bug，用GPT-4o做设计——没有银弹模型，只有精准匹配”

> 真正的AI革命从不替代工程师，而是淘汰不会指挥AI的工程师。你的思维清晰度，就是生产力的天花板。
